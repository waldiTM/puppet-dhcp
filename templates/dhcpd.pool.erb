# <%= @name %>
subnet <%= @network %> netmask <%= @mask %> {
<% if (@range && @range.is_a?(String) && !@range.strip.empty?) || (@range && @range.is_a?(Array)) -%>
  pool
  {
<% if @failover && !@failover.strip.empty? -%>
    failover peer "<%= @failover %>";
<% end -%>
<% if @pool_parameters.is_a? Array -%>
<%   @pool_parameters.each do |param| -%>
    <%= param %>;
<%   end -%>
<% elsif @pool_parameters && !@pool_parameters.strip.empty? -%>
    <%= @pool_parameters %>;
<% end -%>
<% if @range and @range.is_a? Array -%>
<% @range.each do |rng| -%>
    range <%= rng %>;
<% end -%>
<% elsif @range && !@range.strip.empty? -%>
    range <%= @range %>;
<% end -%>
  }
<% end -%>

<% if @domain_name && !@domain_name.strip.empty? -%>
  option domain-name "<%= @domain_name %>";
<% end -%>
  option subnet-mask <%= @mask %>;
<% if @gateway && !@gateway.strip.empty? -%>
  option routers <%= @gateway %>;
<% end -%>
<% if @static_routes
     entries = @static_routes.each_with_index.map do |static_route, i|
       prefix = static_route['mask'].to_i
       bytes = [prefix]
       network_bytes = (prefix + 7) / 8
       if network_bytes > 0
         bytes <<= static_route['network'].split('.')[0 .. network_bytes - 1]
       end
       bytes <<= static_route['gateway'].split('.')
       "#{bytes.join(', ')}#{i == @static_routes.size - 1 ? ';' : ','}  \# #{static_route['network']}/#{static_route['mask']} => #{static_route['gateway']}"
     end
-%>
  option rfc3442-classless-static-routes
<%   entries.each do |r| -%>
    <%= r %>
<%   end -%>
  option ms-classless-static-routes
<%   entries.each do |r| -%>
    <%= r %>
<%   end -%>
<% end -%>
<% if @options.is_a? Array -%>
<%   @options.each do |opt| -%>
  option <%= opt %>;
<%   end -%>
<% elsif @options && !@options.strip.empty? -%>
  option <%= @options %>;
<% end -%>
<% if @parameters.is_a? Array -%>
<%   @parameters.each do |param| -%>
  <%= param %>;
<%   end -%>
<% elsif @parameters && !@parameters.strip.empty? -%>
  <%= @parameters %>;
<% end -%>
<% if @nameservers and @nameservers.is_a? Array -%>
  option domain-name-servers <%= @nameservers.sort.join(', ') %>;
<% elsif @nameservers -%>
  option domain-name-servers <%= @nameservers %>;
<% end -%>
<% if @search_domains and @search_domains.is_a? Array -%>
  option domain-search "<%= @search_domains.sort.join('", "') %>";
<% elsif @search_domains -%>
  option domain-search "<%= @search_domains.split(/[, ]+/).join('", "') %>";
<% end -%>
<% if @mtu -%>
  option interface-mtu <%= @mtu %>;
<% end -%>
<% if @pxeserver -%>
  next-server <%= @pxeserver %>;
<% end -%>
}

